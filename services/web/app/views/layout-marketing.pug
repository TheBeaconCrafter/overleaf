extends ./layout-base

include ./_mixins/formMessages
include ./_mixins/bootstrap_js

block entrypointVar
	- entrypoint = 'marketing'

block body
	if typeof suppressNavbar === 'undefined'
		include layout/navbar-marketing

	block content

	if typeof suppressFooter === 'undefined'
		if showThinFooter
			include layout/thin-footer
		else
			include layout/fat-footer

	if typeof suppressPugCookieBanner == 'undefined'
		include _cookie_banner

	!= moduleIncludes('contactModal-marketing', locals)

block prepend foot-scripts
	+bootstrap-js
	script(type='text/javascript' nonce=scriptNonce).
		// Theme toggle for marketing pages
		(function() {
			function getCookie(name) {
				const value = '; ' + document.cookie;
				const parts = value.split('; ' + name + '=');
				if (parts.length === 2) return parts.pop().split(';').shift();
				return null;
			}
			
			function setCookie(name, value, days) {
				const date = new Date();
				date.setTime(date.getTime() + (days || 365) * 24 * 60 * 60 * 1000);
				const expires = 'expires=' + date.toUTCString();
				document.cookie = name + '=' + value + ';' + expires + ';path=/;SameSite=Lax';
			}
			
			function getCurrentTheme() {
				return document.body.classList.contains('dark-theme-marketing') ? 'dark' : 'light';
			}
			
			function applyTheme(theme) {
				if (theme === 'dark') {
					document.body.classList.add('dark-theme-marketing');
				} else {
					document.body.classList.remove('dark-theme-marketing');
				}
			}
			
			function updateToggleIcon(theme) {
				const icon = document.getElementById('theme-icon');
				if (icon) {
					icon.textContent = theme === 'dark' ? 'light_mode' : 'dark_mode';
				}
			}
			
			function initThemeToggle() {
				const toggleBtn = document.getElementById('theme-toggle-btn');
				if (!toggleBtn) return;
				
				const savedTheme = getCookie('overleaf_theme');
				const currentTheme = savedTheme || getCurrentTheme();
				
				if (savedTheme && savedTheme !== getCurrentTheme()) {
					applyTheme(savedTheme);
				}
				
				updateToggleIcon(currentTheme);
				
				toggleBtn.addEventListener('click', function() {
					const currentTheme = getCurrentTheme();
					const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
					applyTheme(newTheme);
					setCookie('overleaf_theme', newTheme);
					updateToggleIcon(newTheme);
				});
			}
			
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', initThemeToggle);
			} else {
				initThemeToggle();
			}
		})();
